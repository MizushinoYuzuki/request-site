<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Palette+Mosaic&family=Zen+Kaku+Gothic+New&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="images/icon/icon_white.png" />
        <title>Mizushino</title>
        <link rel="stylesheet" href="css/pricing-style.css" />
    </head>

    <body class="link-transition">
        <header>
            <nav class="nav-container">
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul class="menu" id="nav-menu">
                    <li><a href="index.html">About</a></li>
                    <li><a href="works.html">Works</a></li>
                    <li><a href="#">Pricing</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
                <!-- <h1>ご依頼について</h1>
                <p>以下の内容をご確認の上、フォームからご相談ください。</p> -->
            </nav>
        </header>

        <main>
            <section class="pricing">
                <h2>料金の目安</h2>
                <ul>
                <li>基本料金：¥8,000</li>
                </ul>
            </section>

            <section class="form">
                <h2>依頼フォーム</h2>
                <form action="https://formspree.io/f/xvgalrbr" method="POST" id="requestForm">
                <label>
                    お名前：
                    <textarea name="pn" rows="1"></textarea>
                </label>

                <!-- <label>
                    SNS：
                    <textarea name="sns" rows="4"></textarea>
                </label> -->
                
                <label>
                    依頼内容：
                    <select name="t" required><option value="">選択してください</option>
                    <option value="c">カバー楽曲MV</option>
                    <option value="o">オリジナル楽曲MV</option>
                    <option value="3d">3DCG</option>
                    <option value="mg">モーショングラフィックス</option>
                    <option value="v">動画編集（Premiere Pro）</option>
                    </select>
                </label>

                <div id="coverOptions" style="display: none; /* margin-top: 1rem; */ ">
                    <label>
                        MVスタイル：
                        <select name="cs"> <option value="">選択してください</option>
                            <option value="h">本家風MV</option>
                            <option value="o">完全オリジナルMV</option>
                        </select>
                    </label>
                </div>

                <label>
                    納期の希望：
                    <select name="d" required> <option value="">選択してください</option>
                    <option value="2w">2週間以内</option>
                    <option value="1m">1月以内</option>
                    <option value="2m">2月以内</option>
                    <option value="3m">3月以内</option>
                    <option value="4m">4月以内</option>
                    <option value="5m">5月以内</option>
                    <option value="6m">半年以内</option>
                    <option value="none">指定なし</option>
                    </select>
                </label>

                <label>
                    3DCGの使用：
                    <select name="3DCG使用" required>
                    <option value="">選択してください</option>
                    <option value="0">未使用</option>
                    <option value="1">一部使用</option>
                    <option value="2">全部使用</option>
                    </select>
                </label>

                <label>
                    合唱人数（+1人ごとに+¥2,000）：
                    <select name="合唱人数" required>
                    <option value="">選択してください</option>
                    <option value="1">1人</option>
                    <option value="2">2人</option>
                    <option value="3">3人</option>
                    <option value="4">4人</option>
                    <option value="5">5人以上</option>
                    </select>
                </label>

                <label>
                    ご希望の連絡手段：
                    <select name="contact" id="contactSelect" required>
                    <option value="">選択してください</option>
                    <option value="email">メール</option>
                    <option value="xDM">X(旧Twitter)</option>
                    <option value="Discord">Discord</option>
                    <option value="Slack">Slack</option>
                    </select>
                </label>
                    
                <div id="mailaddress" style="display: none;">
                    <label>
                        メールアドレス：
                        <input type="email" name="email">
                    </label>
                </div>

                <div id="xDM" style="display: none;">
                    <label>
                        Xのアカウント：
                        <textarea name="xAccount" rows="1"></textarea>
                    </label>
                </div>

                <div id="discordDM" style="display: none;">
                    <label>
                        Discordアカウント：
                        <textarea name="discordAccount" rows="1"></textarea>
                    </label>
                </div>

                <div id="slackDM" style="display: none;">
                    <label>
                        Slack：
                        <textarea name="slackAccount" rows="1"></textarea>
                    </label>
                </div>

                <fieldset>
                    <legend>追加オプション（該当するものにチェック）</legend>
                    <div id="originalOptions" style="display: none; margin-bottom: 1.3rem;">
                        <label>
                            <input type="checkbox" name="opt" name="sb">
                            絵コンテからの打ち合わせを希望する
                        </label>
                    </div>
                    <label><input type="checkbox" name="opt" value="hs" /> 立ち絵の髪揺れあり</label><br />
                    <label><input type="checkbox" name="opt" value="nc" /> クレジット記載なし</label><br />
                    <label><input type="checkbox" name="opt" value="ct" /> 著作権譲渡</label><br />
                    <label><input type="checkbox" name="opt" value="cu" /> 商用利用</label><br />
                    <label><input type="checkbox" name="opt" value="np" /> ポートフォリオ掲載不可</label><br />
                    <label><input type="checkbox" name="opt" value="bd" />駆け出しクリエイター応援値引き<br />
                    <small>
                        ※ 活動開始から1年以内の活動者さまのみです。<br />
                        ※ 月1のみの対応となります。
                    </small>
                </label>
                </fieldset>

                <!-- <label>
                    メールアドレス<small>(任意)</small>：
                    <input type="email" name="email">
                </label> -->

                <label>
                    その他ご要望：
                    <textarea name="msg" rows="4"></textarea>
                </label>

                <div id="totalDisplay">合計金額: ¥0</div>
                <button type="submit">送信</button>
                </form>

                <div class="share-buttons">
                    <button id="shareViaEmail" type="button">メールで共有</button>
                    <button id="shareViaUrl" type="button">URLをコピー</button>
                    <button id="shareViaText" type="button">内容をコピー</button>
                </div>
            </section>

            <script>
            document.addEventListener("DOMContentLoaded", function () {
                const priceConfig = {
                    base: 8000,
                    cg: { "1": 5000, "2": 20000 },
                    p: { "2": 2000, "3": 4000, "4": 6000, "5": 8000 },
                    d: { "2w": 10000 },
                    opt: {
                        hs: { price: 2000 },
                        nc: { price: 10000 },
                        ct: { multiplier: 1.5 },
                        cu: { multiplier: 1.5 },
                        np: { multiplier: 2 },
                        bd: { isDiscount: true }
                    }
                };
                
                // --- 要素の取得 ---
                const form = document.getElementById("requestForm");
                const allInputs = form.querySelectorAll('select, input[type="checkbox"], textarea');
                const totalDisplay = document.getElementById("totalDisplay");
                const myTypeSelect = document.querySelector('select[name="t"]');
                const contactSelect = document.getElementById("contactSelect");

                // 共有ボタン
                const shareViaEmailBtn = document.getElementById("shareViaEmail");
                const shareViaUrlBtn = document.getElementById("shareViaUrl");
                const shareViaTextBtn = document.getElementById("shareViaText");
                
                // UI要素
                const uiGroups = {
                    t: {
                        c: [document.getElementById("coverOptions")],
                        o: [document.getElementById("originalOptions")]
                    },
                    ct: {
                        email: [document.getElementById("mailaddress")],
                        x: [document.getElementById("xDM")],
                        discord: [document.getElementById("discordDM")],
                        slack: [document.getElementById("slackDM")]
                    }
                };         

                // const cgSelect = document.querySelector('select[name="3DCG使用"]');
                // const deadlineSelect = document.querySelector('select[name="count"]');
                // const chorusSelect = document.querySelector('select[name="合唱人数"]');
                
                // const checkboxes = document.querySelectorAll('input[type="checkbox"][name="オプション"]')
                
                let lastCalculatedTotal = 0;
                
                // 料金計算
                function calculate() {
                    const formData = new FormData(form);
                    let total = basePrice;
                    let multiplier = 1;
                
                    total += priceConfig.cg[formData.get("cg")] || 0;
                    total += priceConfig.p[formData.get("p")] || 0;
                    total += priceConfig.d[formData.get("d")] || 0;

                    let discount = 0;
                    formData.getAll('opt').forEach(value => {
                        const effect = priceConfig.opt[value];
                        if (!effect) return;
                        if (effect.price) total += effect.price;
                        if (effect.multiplier) multiplier *= effect.multiplier;
                        if (effect.isDiscount) discount = total / 2;
                    });

                    lastCalculatedTotal = Math.round(total * multiplier - discount);
                    totalDisplay.textContent = `🧮 参考料金：¥${lastCalculatedTotal.toLocaleString()}`;
                }

                function updateUrlFromState() {
                    const params = new URLSearchParams();
                    // FormDataの代わりに手動で構築し、空の値は無視する
                    allInputs.forEach(input => {
                        if (input.type === 'checkbox') {
                            if (input.checked) params.append(input.name, input.value);
                        } else if (input.value) {
                            params.append(input.name, input.value);
                        }
                    });
                    const newUrl = `${window.location.pathname}?${params.toString()}`;
                    history.replaceState({}, '', newUrl);
                }

                function applyStateFromUrl() {
                    const params = new URLSerchParams(window.location.search);
                    params.forEach((value, key) => {
                        const elements = form.elements[key];
                        if (!elements) return;

                        if (elements.nodeName === 'FIELDSET' || elements.length > 1) {
                            const values = params.getAll(key);
                            Array.from(elements).forEach(el => {
                                if (el.type === 'checkbox') el.checked = values.includes(el.value);
                            });
                        } else {
                            elements.value = value;
                        }
                    });
                    updateDependentUI();
                }

                function toggleVisibility(group, selectedKey) {
                    Object.entries(group).forEach(([key, elements]) => {
                        elements.forEach(el => {
                            el.style.display = (key === selectedKey) ? 'block' : 'none';
                        });
                    });
                }

                function updateDependentUI() {
                    toggleVisibility(uiGroups.t, mvTypeSelect.value);
                    toggleVisibility(uiGroups.ct, contactSelect.value);
                }

                function handleFormChange() {
                    calculate();
                    updateUrlFromState();
                    updateDependentUI();
                }

                function copyToClipboard(text, message) {
                    navigator.clipboard.writeText(text).then(() => alert(message)).catch(() => alert("コピーに失敗しました。"));
                }

                function getFullTextFromValue(name, value) {
                    if (!value) return '(未選択)';
                    const el = document.querySelector(`select[name="${name}"] option[values="${value}"]`);
                    return el ? el.textContent : value;
                }

                function generateFullTextSummary() {
                    const formData = new FormData(form);
                    const selectedOptionsText = [];
                    formData.getAll('opt').forEach(value => {
                        const label = document.querySelector(`input[name="opt"][value="${value}"]`).parentElement.textContent.trim();
                        selectedOptionsText.push(`- ${label}`);
                    });

                    const summary = `【ご依頼内容のご相談】
                        ■お名前:
                        ${formData.get('pn') || '(未記入)'}
                        ■ご依頼内容:
                        ${getFullTextFromValue('t', formData.get('t'))}
                        ${formData.get('t') === 'c' ? `  - MVスタイル: ${getFullTextFromValue('cs', formData.get('cs'))}` : ''}
                        ■納期の希望:
                        ${getFullTextFromValue('d', formData.get('d'))}
                        ■3DCGの使用:
                        ${getFullTextFromValue('cg', formData.get('cg'))}
                        ■合唱人数:
                        ${getFullTextFromValue('p', formData.get('p'))}
                        ■追加オプション:
                        ${selectedOptionsText.length > 0 ? selectedOptionsText.join('\n') : 'なし'}
                        ■ご希望の連絡手段:
                        ${getFullTextFromValue('ct', formData.get('ct'))}
                        ■その他ご要望:
                        ${formData.get('msg') || '(未記入)'}
                        ---------------------------------
                        ■参考料金: ¥${lastCalculatedTotal.toLocaleString()}`;
                    return summary.trim();
                }

                // イベントリスナーと初期化 ---
                allInputs.forEach(input => input.addEventListener('change', handleFormChange));

                document.getElementById("shareViaEmail").addEventListener('click', () => {
                    const recipientEmail = "mirock.works@gmail.com";
                    const subject = "ご依頼内容のご相談";
                    const body = `参考料金結果になります。\n\n${window.location.href}\n金額: ¥${lastCalculatedTotal.toLocaleString()}\n\n--- ご依頼概要（曲名など）をこちらに書いてください。 ---\n\nご確認よろしくお願いいたします。`;
                    window.location.href = `mailto:${recipientEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                });

                document.getElementById("shareViaUrl").addEventListener('click', () => copyToClipboard(window.location.href, "このページのURLをコピーしました。"));
                document.getElementById("shareViaText").addEventListener('click', () => copyToClipboard(generateFullTextSummary(), "ご依頼内容をクリップボードにコピーしました。"));

                document.getElementById("hamburger").addEventListener("click", function () {
                    this.classList.toggle("active");
                    document.getElementById("nav-menu").classList.toggle("show");
                })
                
                // const hamburger = document.getElementById("hamburger");
                // const navMenu = document.getElementById("nav-menu"); 
                
                // 3DCG使用
                /*switch (formData.get("3DCG使用")) {
                    case "一部使用":
                    total += 5000;
                    break;
                    case "全部使用":
                    total += 20000;
                    break;
                }

                // 合唱人数
                switch (formData.get("合唱人数")) {
                    case "2人":
                    total += 2000;
                    break;
                    case "3人":
                    total += 4000;
                    break;
                    case "4人":
                    total += 6000;
                    break;
                    case "5人以上":
                    total += 8000;
                    break;
                }

                // チェックボックス項目
                let discount = 0;
                const options = formData.getAll('オプション');
                options.forEach(value => {
                    switch (value) {
                        case "hairSway":
                        total += 2000;
                        break;
                        case "noCredit":
                        total += 10000;
                        break;
                        case "copyrightTrasfer":
                        multiplier *= 1.5;
                        break;
                        case "commercialUse":
                        multiplier *= 1.5;
                        break;
                        case "noPortfolio":
                        multiplier *= 2;
                        break;
                        case "beginnerDiscount":
                        discount = total / 2;
                        break;
                    }
                });

                // ⏰ 納期が2週間以内なら追加料金
                if (formData.get("count") === "2週間以内") {
                    total += 10000;
                }

                let finalTotal = Math.round(total * multiplier - discount);
                lastCalculatedTotal = finalTotal;
                totalDisplay.textContent = `🧮 参考料金：¥${finalTotal.toLocaleString()}`;
                }

                function updateUrlFromState() {
                    const formData = new FormData(form);
                    const params = new URLSearchParams();
                    
                    formData.forEach((value, key) => {
                        if (value) {
                            params.append(key, value);
                        }
                    });

                    const newUrl = `${window.location.pathname}?${params.toString()}`;
                    history.pushState({}, '', newUrl);
                }*/

                /* URLのパラメータを読み取ってフォームに適用する */
                /*function applyStateFromUrl() {
                    const params = new URLSearchParams(window.location.search);
                    // チェックボックスの値を保持する
                    const optionValues = params.getAll('オプション');

                    params.forEach((value, key) => {
                        if (key === 'オプション') return;

                        const element = form.querySelector(`[name="${key}"]`);
                        if (element) {
                            element.value = value;
                        }
                    });

                    // チェックボックスの状態を復元する
                    const checkboxes = form.querySelectorAll('input[name="オプション"]');
                    checkboxes.forEach(cb => {
                        if (optionValues.includes(cb.value)) {
                            cb.checked = true;
                        }
                    });

                    // フォームの値がリセットされたあとに、UIの表示を更新する
                    updateDependentUI();
                }*/

                /* フォームの値に基づいて表示が切り替わるUIを更新する */
                /*function updateDependentUI() {
                    // 依頼内容によって表示切替する
                    contactSelect.addEventListener("change", function () {
                    const selected = contactSelect.value;
                    mailaddress.style.display = (selected === "email") ? "block" : "none";
                    xDM.style.display = (selected === "xDM") ? "block" : "none";
                    discordDM.style.display = (selected === "Discord") ? "block" : "none";
                    slackDM.style.display = (selected === "Slack") ? "block" : "none";
                    });

                    mvType.addEventListener("change", function () {
                        const selected = mvType.value;
                        coverOptions.style.display = "none";
                        originalOptions.style.display = "none";
        
                        if (selected === "cover") {
                            coverOptions.style.display = "block";
                        } else if (selected === "original") {
                            originalOptions.style.display = "block";
                        }
                    });
                }*/

                /* フォームの内容が変更されたときに実行する */
                /*function handleFormChange() {
                    calculate();
                    updateUrlFromState();
                    updateDependentUI();
                }*/

                /* 内容をコピー用の全文テキストを生成する */
                /*function generateFullTextSummary() {
                    const formData = new FormData(form);
                    const selectedOptions = [];
                    formData.getAll('オプション').forEach(option => {
                        selectedOptions.push(`- ${option}`);
                    });

                    let contactDetails = '';
                    const contactMethod = formData.get('contact');
                    if (contactMethod === 'メール') {
                        contactDetails = `  - メールアドレス: ${formData.get('email') || '(未記入)'}`;
                    } else if (contactMethod === 'XのDM') {
                        contactDetails = `  - Xアカウント: ${formData.get('xAccount') || '(未記入)'}`;
                    } else if (contactMethod === 'Discord') {
                        contactDetails = `  - Discordアカウント: ${formData.get('discordAccount') || '(未記入)'}`;
                    } else if (contactMethod === 'Slack') {
                        contactDetails = `  - Slackアカウント: ${formData.get('slackAccount') || '(未記入)'}`;
                    }
        
                    const summary = `【ご依頼内容のご相談】
        
                    ■お名前:
                    ${formData.get('penname') || '(未記入)'}
                    
                    ■ご依頼内容:
                    ${formData.get('type') || '(未選択)'}
                    ${formData.get('type') === 'cover' ? `  - MVスタイル: ${formData.get('coverStyle') || '(未選択)'}` : ''}
                    
                    ■納期の希望:
                    ${formData.get('count') || '(未選択)'}
                    
                    ■3DCGの使用:
                    ${formData.get('3DCG使用') || '(未選択)'}
                    
                    ■合唱人数:
                    ${formData.get('合唱人数') || '(未選択)'}
                    
                    ■追加オプション:
                    ${selectedOptions.length > 0 ? selectedOptions.join('\n') : 'なし'}
                    
                    ■ご希望の連絡手段:
                    ${contactMethod || '(未選択)'}
                    ${contactDetails}
                    
                    ■その他ご要望:
                    ${formData.get('message') || '(未記入)'}
                    
                    ---------------------------------
                    ■参考料金: ¥${lastCalculatedTotal.toLocaleString()}`;
                    
                    return summary.trim();
                }

                // --- イベントリスナーの設定 ---
                // すべてのフォーム要素に変更があったら処理する
                allInputs.forEach(input => {
                    input.addEventListener('change', handleFormChange);
                });

                // メールで共有する
                shareViaEmailBtn.addEventListener('click', function() {
                    const recipientEmail = "mirock.works@gmail.com";
                    const subject = "ご依頼内容のご相談";
                    const body = `参考料金結果になります。\n\n${window.location.href}\n金額: ¥${lastCalculatedTotal.toLocaleString()}\n\n--- ご依頼概要（曲名など）をこちらに書いてください。 ---\n\nご確認よろしくお願いいたします。`;
                    window.location.href = `mailto:${recipientEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                });

                // URLをコピーする
                shareViaUrlBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        alert("このページのURLをコピーしました。");
                    }).catch(err => {
                        alert("コピーに失敗しました。");
                    });
                });

                // 内容をコピーする
                shareViaTextBtn.addEventListener('click', function() {
                    const textToCopy = generateFullTextSummary();
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        alert("ご依頼内容をクリップボードにコピーしました。");
                    }).catch(err => {
                        alert("コピーに失敗しました。");
                    });
                });

                // ハンバーガーメニュー
                hamburger.addEventListener("click", function () {
                    this.classList.toggle("active");
                    navMenu.classList.toggle("show");
                }); */
                
                // --- 初期化処理 ---
                applyStateFromUrl();
                calculate();
            });
        </script>
    </body>
</html>














